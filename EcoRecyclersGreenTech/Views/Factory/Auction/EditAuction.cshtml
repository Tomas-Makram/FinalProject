@model EcoRecyclersGreenTech.Models.FactoryStore.Products.AuctionProductDetailsModel

@{
    ViewData["Title"] = "Edit Auction";
    var nonce = Context.Items["CSPNonce"] as string ?? string.Empty;

    var canModify = ViewBag.CanModify as bool? ?? true;

    // استخراج الصور الحالية من النموذج
    var currentImages = new List<string>();
    if (!string.IsNullOrWhiteSpace(Model.CurrentImageUrl1))
        currentImages.Add(Model.CurrentImageUrl1);
    if (!string.IsNullOrWhiteSpace(Model.CurrentImageUrl2))
        currentImages.Add(Model.CurrentImageUrl2);
    if (!string.IsNullOrWhiteSpace(Model.CurrentImageUrl3))
        currentImages.Add(Model.CurrentImageUrl3);

    // مكان الـ placeholders
    string placeholder1 = "https://placehold.co/300x200/e9ecef/6c757d?text=No+Image+1";
    string placeholder2 = "https://placehold.co/300x200/e9ecef/6c757d?text=No+Image+2";
    string placeholder3 = "https://placehold.co/300x200/e9ecef/6c757d?text=No+Image+3";

    // تحديد الصور الحالية أو placeholders
    string img1 = !string.IsNullOrWhiteSpace(Model.CurrentImageUrl1) ? Model.CurrentImageUrl1! : placeholder1;
    string img2 = !string.IsNullOrWhiteSpace(Model.CurrentImageUrl2) ? Model.CurrentImageUrl2! : placeholder2;
    string img3 = !string.IsNullOrWhiteSpace(Model.CurrentImageUrl3) ? Model.CurrentImageUrl3! : placeholder3;
}

<div class="dashboard-premium">
    <div class="container">
        <div class="dashboard-shell">
            <div class="dashboard-content-wrap-full">
                <div class="dashboard-card-full">

                    <!-- Header -->
                    <div class="auth-head">
                        <div class="auth-logo">
                            <i class="bi bi-pencil-square"></i>
                        </div>
                        <h3 class="mb-1">Edit Auction</h3>
                        <p class="mb-0 text-muted small">Update the details of your auction</p>
                    </div>

                    <div class="auth-body">
                        <!-- Breadcrumb -->
                        <nav aria-label="breadcrumb" class="mb-4">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a asp-action="Index">Dashboard</a></li>
                                <li class="breadcrumb-item"><a asp-action="Auctions">Auctions</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Edit Auction</li>
                            </ol>
                        </nav>

                        @if (!canModify)
                        {
                            <div class="premium-card alert alert-warning mb-4 border-0">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-exclamation-triangle-fill fs-4 me-3 text-warning"></i>
                                    <div>
                                        <h5 class="alert-heading mb-1 text-label">Restricted Editing</h5>
                                        <p class="mb-0 text-label">This auction has active activity. Some fields cannot be modified.</p>
                                    </div>
                                </div>
                            </div>
                        }

                        <!-- عرض الصور الحالية كمعرض في الأعلى -->
                        @if (currentImages.Any())
                        {
                            <div class="premium-card mb-4">
                                <div class="card-header bg-light-subtle border-0 py-3">
                                    <h5 class="card-title mb-0 text-section-title">
                                        <i class="bi bi-image-fill me-2 text-primary"></i>
                                        Current Auction Images
                                    </h5>
                                    <p class="text-muted small mb-0 text-label">These are the images currently stored in the database</p>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        @for (int i = 0; i < 3; i++)
                                        {
                                            <div class="col-md-4">
                                                <div class="premium-card-inner text-center p-0">
                                                    @if (i < currentImages.Count)
                                                    {
                                                        <img src="@currentImages[i]"
                                                             class="img-fluid rounded mb-2"
                                                             style="height: 180px; width: 100%; object-fit: cover;"
                                                             alt="Current Image @(i+1)" />
                                                        <div class="p-3">
                                                            <small class="text-muted d-block text-label">Image @(i + 1)</small>
                                                            <a href="@currentImages[i]"
                                                               target="_blank"
                                                               class="btn btn-sm btn-outline-primary mt-2">
                                                                <i class="bi bi-eye me-1"></i>View Full
                                                            </a>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="d-flex align-items-center justify-content-center"
                                                             style="height: 180px; background-color: var(--bg-light-subtle);">
                                                            <div class="text-center">
                                                                <i class="bi bi-image text-muted" style="font-size: 2rem;"></i>
                                                                <p class="text-muted mt-2 small text-label">No Image @(i + 1)</p>
                                                            </div>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        }

                        <form asp-action="EditAuction"
                              asp-route-id="@Model.Id"
                              method="post"
                              enctype="multipart/form-data"
                              class="needs-validation"
                              novalidate>

                            @Html.AntiForgeryToken()
                            @Html.HiddenFor(m => m.Id)
                            @Html.HiddenFor(m => m.CurrentImageUrl1)
                            @Html.HiddenFor(m => m.CurrentImageUrl2)
                            @Html.HiddenFor(m => m.CurrentImageUrl3)

                            @if (!canModify)
                            {
                                @Html.HiddenFor(m => m.AuctionType)
                                @Html.HiddenFor(m => m.Quantity)
                                @Html.HiddenFor(m => m.StartPrice)
                                @Html.HiddenFor(m => m.StartDate)
                                @Html.HiddenFor(m => m.EndDate)
                                @Html.HiddenFor(m => m.Description)
                            }

                            <div class="premium-card mb-4">
                                <div class="alert alert-danger rounded-3 mb-4" asp-validation-summary="ModelOnly">
                                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                    Please fix the errors below
                                </div>

                                <div class="row g-4">

                                    <!-- Status -->
                                    <div class="col-12">
                                        <div class="premium-card-inner">
                                            <h5 class="card-title mb-3 text-section-title">
                                                <i class="bi bi-toggle-on me-2 text-secondary"></i>
                                                Status
                                            </h5>

                                            <div class="form-floating">
                                                <select asp-for="Status" class="form-select" required>
                                                    <option value="Available">Available</option>
                                                    <option value="Reserved">Reserved</option>
                                                    <option value="SoldOut">Sold Out</option>
                                                    <option value="Inactive">Inactive</option>
                                                </select>
                                                <label asp-for="Status" class="text-label">Current Status *</label>
                                                <span asp-validation-for="Status" class="text-danger small"></span>
                                            </div>

                                            <div class="form-text text-label">
                                                <i class="bi bi-info-circle me-1"></i>
                                                You can change status anytime.
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Basic Information -->
                                    <div class="col-12">
                                        <div class="premium-card-inner">
                                            <h5 class="card-title mb-3 text-section-title">
                                                <i class="bi bi-info-circle-fill me-2 text-primary"></i>
                                                Basic Information
                                            </h5>

                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <div class="form-floating">
                                                        <input asp-for="AuctionType" class="form-control" placeholder="Type"
                                                               disabled="@(canModify ? null : "disabled")" required />
                                                        <label asp-for="AuctionType" class="text-label"><i class="bi bi-tag me-1"></i>Product Type *</label>
                                                        <span asp-validation-for="AuctionType" class="text-danger small"></span>
                                                        @if (!canModify)
                                                        {
                                                            <div class="form-text text-warning text-label">
                                                                <i class="bi bi-lock me-1"></i>Locked due to active activity
                                                            </div>
                                                        }
                                                    </div>
                                                </div>

                                                <div class="col-md-3">
                                                    <div class="form-floating">
                                                        <input asp-for="Quantity" type="number" class="form-control" min="1" placeholder="1"
                                                               disabled="@(canModify ? null : "disabled")" required />
                                                        <label asp-for="Quantity" class="text-label"><i class="bi bi-box me-1"></i>Quantity *</label>
                                                        <span asp-validation-for="Quantity" class="text-danger small"></span>
                                                    </div>
                                                </div>

                                                <div class="col-md-3">
                                                    <div class="form-floating">
                                                        <input asp-for="StartPrice" type="number" class="form-control" step="0.01" min="0.01" placeholder="0.00"
                                                               disabled="@(canModify ? null : "disabled")" required />
                                                        <label asp-for="StartPrice" class="text-label"><i class="bi bi-cash-stack me-1"></i>Starting Price *</label>
                                                        <span asp-validation-for="StartPrice" class="text-danger small"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Dates -->
                                    <div class="col-12">
                                        <div class="premium-card-inner">
                                            <h5 class="card-title mb-3 text-section-title">
                                                <i class="bi bi-calendar-event me-2 text-success"></i>
                                                Auction Dates
                                            </h5>

                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <div class="form-floating">
                                                        <input asp-for="StartDate" type="datetime-local"
                                                               value="@(Model.StartDate == default ? "" : Model.StartDate.ToString("yyyy-MM-ddTHH:mm"))"
                                                               class="form-control" disabled="@(canModify ? null : "disabled")" required />
                                                        <label asp-for="StartDate" class="text-label"><i class="bi bi-calendar-check me-1"></i>Start Date & Time *</label>
                                                        <span asp-validation-for="StartDate" class="text-danger small"></span>
                                                    </div>
                                                </div>

                                                <div class="col-md-6">
                                                    <div class="form-floating">
                                                        <input asp-for="EndDate" type="datetime-local" class="form-control"
                                                               disabled="@(canModify ? null : "disabled")" />
                                                        <label asp-for="EndDate" class="text-label"><i class="bi bi-calendar-x me-1"></i>End Date & Time</label>
                                                        <span asp-validation-for="EndDate" class="text-danger small"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Images Upload -->
                                    <div class="col-12">
                                        <div class="premium-card-inner">
                                            <h5 class="card-title mb-3 text-section-title">
                                                <i class="bi bi-images me-2 text-info"></i>
                                                Update Auction Images
                                            </h5>

                                            <div class="premium-card alert alert-info mb-4">
                                                <div class="d-flex">
                                                    <i class="bi bi-info-circle-fill me-2"></i>
                                                    <div class="text-label">
                                                        <strong>Current Images:</strong>
                                                        @if (currentImages.Any())
                                                        {
                                                            <span>You have @currentImages.Count image(s) stored</span>
                                                        }
                                                        else
                                                        {
                                                            <span>No images currently stored</span>
                                                        }
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row g-4">
                                                <div class="col-md-4">
                                                    <div class="premium-card-inner">
                                                        <!-- Current Image Preview -->
                                                        <div class="mb-3 text-center">
                                                            <div class="position-relative d-inline-block">
                                                                <img id="preview1" src="@img1"
                                                                     class="img-fluid rounded"
                                                                     style="height: 150px; width: 100%; object-fit: cover;"
                                                                     alt="Current Image 1" />
                                                                @if (!string.IsNullOrWhiteSpace(Model.CurrentImageUrl1))
                                                                {
                                                                    <span class="badge bg-success position-absolute top-0 start-0 m-2">
                                                                        Current
                                                                    </span>
                                                                }
                                                            </div>
                                                        </div>

                                                        <div class="mb-2">
                                                            <label asp-for="AuctionImage1" class="form-label fw-semibold text-label">
                                                                <i class="bi bi-upload me-1"></i>@(!string.IsNullOrWhiteSpace(Model.CurrentImageUrl1) ? "Replace Image 1" : "Upload Image 1")
                                                            </label>
                                                            <input asp-for="AuctionImage1" type="file" class="form-control"
                                                                   accept=".jpg,.jpeg,.png,.gif,.webp" id="imageInput1"
                                                                   disabled="@(canModify ? null : "disabled")" />
                                                        </div>

                                                        <div class="form-check form-switch">
                                                            <input class="form-check-input" type="checkbox" id="clearImage1">
                                                            <label class="form-check-label text-danger small text-label" for="clearImage1">
                                                                Remove this image
                                                            </label>
                                                        </div>

                                                        <span asp-validation-for="AuctionImage1" class="text-danger small d-block mt-1"></span>
                                                    </div>
                                                </div>

                                                <div class="col-md-4">
                                                    <div class="premium-card-inner">
                                                        <!-- Current Image Preview -->
                                                        <div class="mb-3 text-center">
                                                            <div class="position-relative d-inline-block">
                                                                <img id="preview2" src="@img2"
                                                                     class="img-fluid rounded"
                                                                     style="height: 150px; width: 100%; object-fit: cover;"
                                                                     alt="Current Image 2" />
                                                                @if (!string.IsNullOrWhiteSpace(Model.CurrentImageUrl2))
                                                                {
                                                                    <span class="badge bg-success position-absolute top-0 start-0 m-2">
                                                                        Current
                                                                    </span>
                                                                }
                                                            </div>
                                                        </div>

                                                        <div class="mb-2">
                                                            <label asp-for="AuctionImage2" class="form-label fw-semibold text-label">
                                                                <i class="bi bi-upload me-1"></i>@(!string.IsNullOrWhiteSpace(Model.CurrentImageUrl2) ? "Replace Image 2" : "Upload Image 2")
                                                            </label>
                                                            <input asp-for="AuctionImage2" type="file" class="form-control"
                                                                   accept=".jpg,.jpeg,.png,.gif,.webp" id="imageInput2"
                                                                   disabled="@(canModify ? null : "disabled")" />
                                                        </div>

                                                        <div class="form-check form-switch">
                                                            <input class="form-check-input" type="checkbox" id="clearImage2">
                                                            <label class="form-check-label text-danger small text-label" for="clearImage2">
                                                                Remove this image
                                                            </label>
                                                        </div>

                                                        <span asp-validation-for="AuctionImage2" class="text-danger small d-block mt-1"></span>
                                                    </div>
                                                </div>

                                                <div class="col-md-4">
                                                    <div class="premium-card-inner">
                                                        <!-- Current Image Preview -->
                                                        <div class="mb-3 text-center">
                                                            <div class="position-relative d-inline-block">
                                                                <img id="preview3" src="@img3"
                                                                     class="img-fluid rounded"
                                                                     style="height: 150px; width: 100%; object-fit: cover;"
                                                                     alt="Current Image 3" />
                                                                @if (!string.IsNullOrWhiteSpace(Model.CurrentImageUrl3))
                                                                {
                                                                    <span class="badge bg-success position-absolute top-0 start-0 m-2">
                                                                        Current
                                                                    </span>
                                                                }
                                                            </div>
                                                        </div>

                                                        <div class="mb-2">
                                                            <label asp-for="AuctionImage3" class="form-label fw-semibold text-label">
                                                                <i class="bi bi-upload me-1"></i>@(!string.IsNullOrWhiteSpace(Model.CurrentImageUrl3) ? "Replace Image 3" : "Upload Image 3")
                                                            </label>
                                                            <input asp-for="AuctionImage3" type="file" class="form-control"
                                                                   accept=".jpg,.jpeg,.png,.gif,.webp" id="imageInput3"
                                                                   disabled="@(canModify ? null : "disabled")" />
                                                        </div>

                                                        <div class="form-check form-switch">
                                                            <input class="form-check-input" type="checkbox" id="clearImage3">
                                                            <label class="form-check-label text-danger small text-label" for="clearImage3">
                                                                Remove this image
                                                            </label>
                                                        </div>

                                                        <span asp-validation-for="AuctionImage3" class="text-danger small d-block mt-1"></span>
                                                    </div>
                                                </div>

                                                <div class="col-12">
                                                    <div class="form-text text-label">
                                                        <i class="bi bi-info-circle me-1"></i>
                                                        Leave empty to keep current images. Check "Remove this image" to delete the current image.
                                                        Max 5MB per image. Allowed formats: JPG, PNG, GIF, WebP.
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Description -->
                                    <div class="col-12">
                                        <div class="premium-card-inner">
                                            <h5 class="card-title mb-3 text-section-title">
                                                <i class="bi bi-card-text me-2 text-warning"></i>
                                                Description
                                            </h5>

                                            <div class="form-floating">
                                                <textarea asp-for="Description" class="form-control"
                                                          placeholder="Describe your auction..."
                                                          style="height: 140px"
                                                          disabled="@(canModify ? null : "disabled")"
                                                          required></textarea>
                                                <label asp-for="Description" class="text-label">Description *</label>
                                                <span asp-validation-for="Description" class="text-danger small"></span>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="premium-card">
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted text-label">
                                        <i class="bi bi-info-circle me-1"></i>
                                        Fields marked with * are required
                                    </small>

                                    <div class="d-flex gap-2">
                                        <a asp-action="Auctions" class="btn btn-outline-secondary px-4">
                                            <i class="bi bi-x-circle me-2"></i>Cancel
                                        </a>
                                        <button type="submit" class="auth-btn-warning px-4" id="submitBtn">
                                            <i class="bi bi-save me-2"></i>Update Auction
                                        </button>
                                    </div>
                                </div>
                            </div>

                        </form>

                    </div>

                    <div class="auth-foot">
                        <small class="text-muted">© @DateTime.Now.Year EcoRecyclers GreenTech • Edit Auction</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style nonce="@nonce">
    /* ===================== PREMIUM EDIT AUCTION STYLES ===================== */
    :root {
        --eco-gold: #f59e0b;
        --eco-amber: #fbbf24;
        --eco-orange: #fb923c;
        --ink: #0f172a;
        --muted: #64748b;
        --glass: rgba(255,255,255,.72);
        --border: rgba(245,158,11,.18);
        --shadow: 0 22px 60px rgba(2,6,23,.12);
        --radius: 22px;
        --bg-light-subtle: rgba(248, 249, 250, 0.5);
    }

    /* Animated background with gold/orange theme */
    body {
        background: radial-gradient(900px 500px at 18% 18%, rgba(245,158,11,.15), transparent 60%), radial-gradient(900px 500px at 80% 25%, rgba(251,191,36,.15), transparent 55%), radial-gradient(700px 450px at 55% 85%, rgba(251,146,60,.12), transparent 55%), linear-gradient(180deg, rgba(254,252,232,.92), rgba(255,250,240,.92));
        min-height: 100vh;
        animation: gradientShift 20s ease infinite alternate;
    }

    @@keyframes gradientShift {
        0% {
            background: radial-gradient(900px 500px at 18% 18%, rgba(245,158,11,.15), transparent 60%), radial-gradient(900px 500px at 80% 25%, rgba(251,191,36,.15), transparent 55%), radial-gradient(700px 450px at 55% 85%, rgba(251,146,60,.12), transparent 55%), linear-gradient(180deg, rgba(254,252,232,.92), rgba(255,250,240,.92));
        }

        50% {
            background: radial-gradient(1000px 600px at 25% 15%, rgba(251,191,36,.12), transparent 60%), radial-gradient(800px 450px at 75% 30%, rgba(245,158,11,.12), transparent 55%), radial-gradient(600px 400px at 45% 90%, rgba(251,146,60,.10), transparent 55%), linear-gradient(180deg, rgba(255,250,240,.92), rgba(254,252,232,.92));
        }

        100% {
            background: radial-gradient(950px 550px at 15% 22%, rgba(251,146,60,.14), transparent 60%), radial-gradient(850px 500px at 85% 20%, rgba(251,191,36,.10), transparent 55%), radial-gradient(750px 500px at 60% 80%, rgba(245,158,11,.10), transparent 55%), linear-gradient(180deg, rgba(254,252,232,.92), rgba(255,250,240,.92));
        }
    }

    /* Dashboard Shell */
    .dashboard-premium {
        min-height: calc(100vh - 140px);
        display: flex;
        align-items: center;
        padding: 10px 0 25px;
    }

    .dashboard-shell {
        width: 100%;
        max-width: 1400px;
        margin: 0 auto;
        border-radius: var(--radius);
        border: 1px solid var(--border);
        background: rgba(255,255,255,.55);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        box-shadow: var(--shadow);
        overflow: hidden;
        animation: fadeIn 0.6s ease-out;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Full Width Content */
    .dashboard-content-wrap-full {
        padding: 26px;
        background: rgba(255,255,255,.35);
    }

    .dashboard-card-full {
        width: 100%;
        border-radius: 20px;
        border: 1px solid rgba(15,23,42,.08);
        background: var(--glass);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        box-shadow: 0 18px 45px rgba(2,6,23,.10);
        overflow: hidden;
    }

    /* Auth Components */
    .auth-head {
        padding: 22px 22px 14px;
        text-align: center;
        background: linear-gradient(135deg, rgba(245,158,11,.08), rgba(251,191,36,.06));
        border-bottom: 1px solid rgba(15,23,42,.06);
    }

    .auth-logo {
        width: 54px;
        height: 54px;
        border-radius: 16px;
        margin: 0 auto 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        background: linear-gradient(135deg, var(--eco-gold), var(--eco-amber));
        box-shadow: 0 12px 25px rgba(245,158,11,.18);
        font-size: 1.35rem;
    }

    .auth-head h3 {
        color: var(--ink);
    }

    .auth-head .text-muted {
        color: var(--muted);
    }

    .auth-body {
        padding: 0 22px 18px;
    }

    .auth-foot {
        padding: 14px 22px;
        text-align: center;
        background: rgba(255,255,255,.55);
        border-top: 1px solid rgba(15,23,42,.08);
    }

    /* Premium Cards */
    .premium-card {
        border: 1px solid rgba(15,23,42,.08);
        background: rgba(255,255,255,.82);
        backdrop-filter: blur(8px);
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 24px;
        transition: all 0.3s ease;
    }

    .premium-card-inner {
        border: 1px solid rgba(15,23,42,.06);
        background: rgba(255,255,255,.95);
        border-radius: 14px;
        padding: 20px;
        margin-bottom: 16px;
    }

    .premium-card:hover {
        box-shadow: 0 15px 35px rgba(2,6,23,.10);
        transform: translateY(-3px);
    }

    /* Breadcrumb */
    .breadcrumb {
        background-color: transparent;
        padding: 12px 0;
        margin-bottom: 0;
    }

    .breadcrumb-item a {
        text-decoration: none;
        color: var(--muted);
        transition: color 0.2s ease;
    }

        .breadcrumb-item a:hover {
            color: var(--eco-gold);
        }

    .breadcrumb-item.active {
        color: var(--ink);
        font-weight: 500;
    }

    /* Text Label Classes - Adaptive for Light/Dark Mode */
    .text-label {
        color: var(--ink) !important;
    }

    .text-section-title {
        color: var(--ink) !important;
        font-weight: 600;
    }

    /* Form Controls */
    .form-control, .form-select {
        border: 1px solid rgba(15,23,42,.12);
        background-color: rgba(255,255,255,.9);
        color: var(--ink);
        border-radius: 10px;
        padding: 16px;
    }

        .form-control:focus, .form-select:focus {
            border-color: var(--eco-gold);
            box-shadow: 0 0 0 .25rem rgba(245,158,11,.18);
            background-color: rgba(255,255,255,1);
        }

        .form-control:disabled, .form-select:disabled {
            background-color: rgba(248,249,250,.8);
            color: var(--muted);
        }

    .form-floating > label {
        color: var(--muted);
    }

    .form-floating > .form-control:focus ~ label,
    .form-floating > .form-control:not(:placeholder-shown) ~ label {
        color: var(--eco-gold);
    }

    .form-text {
        color: var(--muted) !important;
    }

    /* Buttons */
    .auth-btn-warning {
        border: 0 !important;
        border-radius: 999px !important;
        background: linear-gradient(90deg, var(--eco-gold), var(--eco-orange)) !important;
        font-weight: 800;
        letter-spacing: .2px;
        box-shadow: 0 12px 26px rgba(245,158,11,.22);
        transition: transform .22s ease, box-shadow .22s ease, filter .22s ease;
        color: white !important;
        padding: 10px 24px !important;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border: none;
    }

        .auth-btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 16px 34px rgba(251,146,60,.22);
            filter: brightness(1.02);
            color: white !important;
        }

    .btn-outline-secondary {
        border-color: rgba(15,23,42,.15);
        color: var(--ink);
        border-radius: 999px;
        padding: 10px 24px;
    }

        .btn-outline-secondary:hover {
            background-color: rgba(15,23,42,.05);
            border-color: rgba(15,23,42,.25);
        }

    /* Alerts */
    .alert {
        border: none;
        border-radius: 12px;
        backdrop-filter: blur(8px);
    }

    .alert-warning {
        background: rgba(255,243,205,.85);
        color: var(--ink);
    }

    .alert-danger {
        background: rgba(248,215,218,.85);
        color: var(--ink);
    }

    .alert-info {
        background: rgba(207,244,252,.85);
        color: var(--ink);
    }

    /* Image Preview */
    .position-relative {
        position: relative;
    }

    .position-absolute {
        position: absolute;
    }

    /* Form Switch */
    .form-check-input:checked {
        background-color: var(--eco-gold);
        border-color: var(--eco-gold);
    }

    .form-check-input:focus {
        border-color: var(--eco-gold);
        box-shadow: 0 0 0 .25rem rgba(245,158,11,.25);
    }

    /* ===================== DARK MODE TUNING ===================== */
    [data-bs-theme="dark"] body {
        background: radial-gradient(900px 500px at 18% 18%, rgba(245,158,11,.10), transparent 60%), radial-gradient(900px 500px at 80% 25%, rgba(251,191,36,.10), transparent 55%), radial-gradient(700px 450px at 55% 85%, rgba(251,146,60,.08), transparent 55%), linear-gradient(180deg, rgba(2,6,23,.92), rgba(15,23,42,.92));
        animation: gradientShiftDark 20s ease infinite alternate;
    }

    @@keyframes gradientShiftDark {
        0% {
            background: radial-gradient(900px 500px at 18% 18%, rgba(245,158,11,.10), transparent 60%), radial-gradient(900px 500px at 80% 25%, rgba(251,191,36,.10), transparent 55%), radial-gradient(700px 450px at 55% 85%, rgba(251,146,60,.08), transparent 55%), linear-gradient(180deg, rgba(2,6,23,.92), rgba(15,23,42,.92));
        }

        50% {
            background: radial-gradient(1000px 600px at 25% 15%, rgba(251,191,36,.08), transparent 60%), radial-gradient(800px 450px at 75% 30%, rgba(245,158,11,.08), transparent 55%), radial-gradient(600px 400px at 45% 90%, rgba(251,146,60,.06), transparent 55%), linear-gradient(180deg, rgba(15,23,42,.92), rgba(2,6,23,.92));
        }

        100% {
            background: radial-gradient(950px 550px at 15% 22%, rgba(251,146,60,.10), transparent 60%), radial-gradient(850px 500px at 85% 20%, rgba(251,191,36,.08), transparent 55%), radial-gradient(750px 500px at 60% 80%, rgba(245,158,11,.08), transparent 55%), linear-gradient(180deg, rgba(2,6,23,.92), rgba(15,23,42,.92));
        }
    }

    [data-bs-theme="dark"] .dashboard-shell {
        background: rgba(15, 23, 42, .55);
        border-color: rgba(148, 163, 184, .18);
        box-shadow: 0 22px 60px rgba(0,0,0,.45);
    }

    [data-bs-theme="dark"] .dashboard-content-wrap-full {
        background: rgba(2, 6, 23, .35);
    }

    [data-bs-theme="dark"] .dashboard-card-full {
        background: rgba(15, 23, 42, .70);
        border-color: rgba(148, 163, 184, .16);
        box-shadow: 0 18px 45px rgba(0,0,0,.35);
    }

    [data-bs-theme="dark"] .auth-head {
        background: linear-gradient(135deg, rgba(245,158,11,.08), rgba(251,191,36,.06));
        border-bottom-color: rgba(148, 163, 184, .16);
    }

        [data-bs-theme="dark"] .auth-head h3 {
            color: #e2e8f0 !important;
        }

        [data-bs-theme="dark"] .auth-head .text-muted {
            color: rgba(226, 232, 240, .75) !important;
        }

    /* Text Adaptation for Dark Mode */
    [data-bs-theme="dark"] .text-label {
        color: #e2e8f0 !important;
    }

    [data-bs-theme="dark"] .text-section-title {
        color: #e2e8f0 !important;
    }

    [data-bs-theme="dark"] .text-muted {
        color: rgba(226, 232, 240, .75) !important;
    }

    [data-bs-theme="dark"] .breadcrumb-item.active {
        color: #e2e8f0 !important;
    }

    [data-bs-theme="dark"] .breadcrumb-item a {
        color: rgba(226, 232, 240, .65) !important;
    }

        [data-bs-theme="dark"] .breadcrumb-item a:hover {
            color: var(--eco-gold) !important;
        }

    /* Cards and Components for Dark Mode */
    [data-bs-theme="dark"] .premium-card {
        background: rgba(2, 6, 23, .45);
        border-color: rgba(148, 163, 184, .16);
    }

    [data-bs-theme="dark"] .premium-card-inner {
        background: rgba(15, 23, 42, .6);
        border-color: rgba(148, 163, 184, .1);
    }

    [data-bs-theme="dark"] .bg-light-subtle {
        background-color: rgba(30, 41, 59, 0.5) !important;
        border-color: rgba(148, 163, 184, .1);
    }

    /* Form Controls Dark Mode */
    [data-bs-theme="dark"] .form-control,
    [data-bs-theme="dark"] .form-select {
        background-color: rgba(15, 23, 42, 0.7);
        border-color: rgba(148, 163, 184, .2);
        color: #e2e8f0;
    }

        [data-bs-theme="dark"] .form-control:focus,
        [data-bs-theme="dark"] .form-select:focus {
            background-color: rgba(15, 23, 42, 0.8);
            border-color: var(--eco-gold);
            color: #e2e8f0;
            box-shadow: 0 0 0 .25rem rgba(245,158,11,.25);
        }

        [data-bs-theme="dark"] .form-control:disabled,
        [data-bs-theme="dark"] .form-select:disabled {
            background-color: rgba(30, 41, 59, 0.5);
            color: rgba(226, 232, 240, .5);
        }

    [data-bs-theme="dark"] .form-floating > label {
        color: rgba(226, 232, 240, .7);
    }

    [data-bs-theme="dark"] .form-floating > .form-control:focus ~ label,
    [data-bs-theme="dark"] .form-floating > .form-control:not(:placeholder-shown) ~ label {
        color: var(--eco-gold);
    }

    [data-bs-theme="dark"] .form-text {
        color: rgba(226, 232, 240, .6) !important;
    }

    /* Buttons Dark Mode */
    [data-bs-theme="dark"] .btn-outline-secondary {
        border-color: rgba(148, 163, 184, .3);
        color: #e2e8f0;
    }

        [data-bs-theme="dark"] .btn-outline-secondary:hover {
            background-color: rgba(148, 163, 184, .1);
            border-color: rgba(148, 163, 184, .4);
            color: #ffffff;
        }

    /* Alerts Dark Mode */
    [data-bs-theme="dark"] .alert-warning {
        background: rgba(102, 77, 3, .5);
        color: #fef3c7;
    }

    [data-bs-theme="dark"] .alert-danger {
        background: rgba(127, 29, 29, .5);
        color: #fecaca;
    }

    [data-bs-theme="dark"] .alert-info {
        background: rgba(12, 74, 110, .5);
        color: #bae6fd;
    }

    /* Form Switch Dark Mode */
    [data-bs-theme="dark"] .form-check-input {
        background-color: rgba(30, 41, 59, 0.8);
        border-color: rgba(148, 163, 184, .3);
    }

        [data-bs-theme="dark"] .form-check-input:checked {
            background-color: var(--eco-gold);
            border-color: var(--eco-gold);
        }

    /* Responsive */
    @@media (max-width: 1200px) {
        .dashboard-shell {
            max-width: 95%;
        }
    }

    @@media (max-width: 992px) {
        .dashboard-premium {
            min-height: calc(100vh - 120px);
            padding: 10px 0 20px;
        }

        .dashboard-content-wrap-full {
            padding: 18px;
        }

        .auth-logo {
            width: 48px;
            height: 48px;
            font-size: 1.2rem;
        }

        .premium-card {
            padding: 20px;
        }

        .premium-card-inner {
            padding: 16px;
        }
    }

    @@media (max-width: 768px) {
        .premium-card {
            padding: 16px;
        }

        .auth-body {
            padding: 0 16px 14px;
        }

        .col-md-4 {
            width: 100%;
            margin-bottom: 16px;
        }

        .d-flex.justify-content-between {
            flex-direction: column;
            gap: 16px;
        }

            .d-flex.justify-content-between > div {
                width: 100%;
            }

        .d-flex.gap-2 {
            justify-content: stretch;
        }

            .d-flex.gap-2 .btn {
                flex: 1;
            }
    }

    @@media (max-width: 576px) {
        .auth-head {
            padding: 18px 16px 12px;
        }

        .dashboard-content-wrap-full {
            padding: 12px;
        }

        .premium-card {
            padding: 12px;
        }

        .row.g-3 .col-md-6,
        .row.g-3 .col-md-3 {
            width: 100%;
        }
    }
</style>

<script nonce="@nonce">
    document.addEventListener('DOMContentLoaded', function () {

        // Initialize image previews with current database images
        const preview1 = document.getElementById('preview1');
        const preview2 = document.getElementById('preview2');
        const preview3 = document.getElementById('preview3');

        const clearImage1 = document.getElementById('clearImage1');
        const clearImage2 = document.getElementById('clearImage2');
        const clearImage3 = document.getElementById('clearImage3');

        const imageInput1 = document.getElementById('imageInput1');
        const imageInput2 = document.getElementById('imageInput2');
        const imageInput3 = document.getElementById('imageInput3');

        // تتبع الصور الأصلية
        const originalImages = {
            img1: preview1.src,
            img2: preview2.src,
            img3: preview3.src
        };

        // Function to bind image preview
        function bindImagePreview(inputId, previewId, clearCheckboxId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            const clearCheckbox = document.getElementById(clearCheckboxId);

            if (!input || !preview || !clearCheckbox) return;

            input.addEventListener('change', function () {
                const file = this.files && this.files[0];
                if (!file) return;

                const maxSize = 5 * 1024 * 1024; // 5MB
                const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];

                // Validate file size
                if (file.size > maxSize) {
                    alert('File size exceeds 5MB limit.');
                    this.value = '';
                    return;
                }

                // Validate file type
                if (!validTypes.includes(file.type)) {
                    alert('Invalid file type. Please upload JPG, PNG, GIF, or WebP image.');
                    this.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = e => {
                    preview.src = e.target.result;
                    clearCheckbox.checked = false; // Uncheck clear if uploading new image
                };
                reader.readAsDataURL(file);
            });

            // Handle clear checkbox
            clearCheckbox.addEventListener('change', function () {
                if (this.checked) {
                    // Show placeholder when clearing
                    const placeholder = previewId === 'preview1' ? '@placeholder1' :
                        previewId === 'preview2' ? '@placeholder2' : '@placeholder3';
                    preview.src = placeholder;
                    input.value = ''; // Clear file input
                } else {
                    // Restore original or current preview
                    const original = previewId === 'preview1' ? originalImages.img1 :
                        previewId === 'preview2' ? originalImages.img2 : originalImages.img3;
                    preview.src = original;
                }
            });
        }

        // Bind all image previews
        bindImagePreview('imageInput1', 'preview1', 'clearImage1');
        bindImagePreview('imageInput2', 'preview2', 'clearImage2');
        bindImagePreview('imageInput3', 'preview3', 'clearImage3');

        // Handle form submission for clear images
        const form = document.querySelector('form.needs-validation');
        if (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                    form.classList.add('was-validated');
                    return;
                }

                form.classList.add('was-validated');

                // Create hidden fields for clear image actions
                const clearImage1 = document.getElementById('clearImage1');
                const clearImage2 = document.getElementById('clearImage2');
                const clearImage3 = document.getElementById('clearImage3');

                if (clearImage1 && clearImage1.checked) {
                    const hiddenField = document.createElement('input');
                    hiddenField.type = 'hidden';
                    hiddenField.name = 'ClearImage1';
                    hiddenField.value = 'true';
                    form.appendChild(hiddenField);
                }

                if (clearImage2 && clearImage2.checked) {
                    const hiddenField = document.createElement('input');
                    hiddenField.type = 'hidden';
                    hiddenField.name = 'ClearImage2';
                    hiddenField.value = 'true';
                    form.appendChild(hiddenField);
                }

                if (clearImage3 && clearImage3.checked) {
                    const hiddenField = document.createElement('input');
                    hiddenField.type = 'hidden';
                    hiddenField.name = 'ClearImage3';
                    hiddenField.value = 'true';
                    form.appendChild(hiddenField);
                }

                // Disable submit button to prevent double submission
                const submitBtn = document.getElementById('submitBtn');
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Saving...';
                }
            }, false);
        }

        // Show message if images are locked
    @if (!canModify)
    {
        <text>
                    const imageInputs = [imageInput1, imageInput2, imageInput3];
                            imageInputs.forEach(input => {
                                if (input) {
                        input.addEventListener('click', function (e) {
                            e.preventDefault();
                            alert('Images cannot be modified because this auction has active activity.');
                        });
                                }
                            });
        </text>
    }
            });
</script>